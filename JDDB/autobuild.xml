<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="build-all" name="Create Runnable Jar for Project JDDB with Jar-in-Jar Loader">

	<property name="build" location="build" />
	<property name="app.version" value="1.0" />
	<property name="app.name" value="JDDB" />
	<property name="app.master" value="jddb-master.jar" />
	<property name="app.shard" value="jddb-shard.jar" />
	<property name="app.manager" value="jddb-manager.jar" />
	<property name="base.dir" value="C:/jddb/" />
	<tstamp><format property="build.time" pattern="yyyy-MM-dd HH:mm:ss" /></tstamp>
	
	<path id="libs">
		<fileset dir="libs" includes="**/*.jar" />
	</path>

	<target name="clean">
		<delete dir="bin" failonerror="false" />
		<delete dir="build" failonerror="false" />
		<delete file="${base.dir}/${app.jar}" failonerror="false" />
		
		<mkdir dir="bin" />
		<mkdir dir="build" />
	</target>
	
	<target name="build-bin" depends="clean">

    	<javac  srcdir="src"
    			destdir="bin"
    			includeantruntime="false"
    			failonerror="true"
    			debug="true">
    		<classpath refid="libs" />
    	</javac>
    	
	</target>
	
	<target name="build-all" depends="build-bin">
		
		<antcall target="build-manager" />
		<antcall target="build-master" />
		<antcall target="build-shard" />
	
	</target>
	
	<target name="build-manager">

        <jar basedir="bin" destfile="build/${app.manager}">
            <manifest>
            	<attribute name="Manifest-Version" value="1.0" />
            	<attribute name="Created-By" value="pstickne" />
                <attribute name="Main-Class" value="jddb.node.ManagerNode" />
                <attribute name="Class-Path" value="." />
            </manifest>
            <zipgroupfileset dir="libs" includes="**/*.jar" />
        </jar>
    	
		<waitfor><available file="build/${app.manager}" /></waitfor>
        <copy file="build/${app.manager}" todir="${base.dir}" />
    	
	</target>
	
	<target name="build-master">

		<jar basedir="bin" destfile="build/${app.master}">
            <manifest>
            	<attribute name="Manifest-Version" value="1.0" />
            	<attribute name="Created-By" value="pstickne" />
                <attribute name="Main-Class" value="jddb.node.MasterNode" />
                <attribute name="Class-Path" value="." />
            </manifest>
            <zipgroupfileset dir="libs" includes="**/*.jar" />
        </jar>
    	
		<waitfor><available file="build/${app.master}" /></waitfor>
        <copy file="build/${app.master}" todir="${base.dir}" />
    	
	</target>
	
    <target name="build-shard">
    	
        <jar basedir="bin" destfile="build/${app.shard}">
            <manifest>
            	<attribute name="Manifest-Version" value="1.0" />
            	<attribute name="Created-By" value="pstickne" />
                <attribute name="Main-Class" value="jddb.node.ShardNode" />
                <attribute name="Class-Path" value="." />
            </manifest>
            <zipgroupfileset dir="libs" includes="**/*.jar" />
        </jar>
    	
		<waitfor><available file="build/${app.shard}" /></waitfor>
        <copy file="build/${app.shard}" todir="${base.dir}" />
    	
    </target>
	
</project>
